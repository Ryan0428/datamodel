box: node
build:
  steps:
    - script:
      name: install chrome headless
      code: |
        apt-get update -y
        apt-get install -y ca-certificates apt-transport-https ttf-wqy-zenhei ttf-unfonts-core
        wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | apt-key add -
        echo "deb https://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list
        apt-get update -y
        apt-get install -y google-chrome-unstable

    - script:
      name: set browser
      code: |
        export CHROME_BIN=/usr/bin/google-chrome-unstable

    - script:
      name: add SSH keys for Bitbucket
      code: |
        chmod +x scripts/add-ssh-keys.sh
        scripts/add-ssh-keys.sh

    - npm-install
    - npm-test

    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

  after-steps:
    - slack-notifier:
        url: https://hooks.slack.com/services/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
        channel: fusionboard-wercker
        username: werckerbot